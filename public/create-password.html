<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Password</title>
</head>
<body>
    <h1>Create Your Account Password</h1>
    <p>Your unique User ID is pre-loaded for this setup.</p>
    
    <form id="setPasswordForm" action="/set-password" method="POST">
        <input type="hidden" id="user_id_hidden" name="user_id">
        
        <label for="display_user_id">Your User ID:</label>
        <input type="text" id="display_user_id" disabled style="font-weight: bold; border: none;"><br><br>

        <label for="password">New Password:</label>
        <input type="password" id="password" name="password" required minlength="6"><br><br>
        
        <label for="confirm_password">Confirm Password:</label>
        <input type="password" id="confirm_password" required minlength="6"><br><br>
        
        <button type="submit">Set Password and Log In</button>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Get the User ID from the URL path (/setup-password/S-2025-001)
            const pathParts = window.location.pathname.split('/');
            const userId = pathParts[pathParts.length - 1]; // Should be the last part

            if (userId && userId.startsWith('S-')) {
                // Pre-fill the hidden field for submission
                document.getElementById('user_id_hidden').value = userId;
                // Display the ID to the user
                document.getElementById('display_user_id').value = userId;
            } else {
                alert('Invalid setup link. Please use the link provided in your email/SMS.');
                window.location.href = '/login.html'; // Redirect if ID is missing
            }
            
            // 2. Add client-side password matching check
            document.getElementById('setPasswordForm').addEventListener('submit', (e) => {
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirm_password').value;

                if (password !== confirmPassword) {
                    e.preventDefault();
                    alert('Error: Passwords do not match!');
                }
            });
        });
    </script>
</body>
</html>